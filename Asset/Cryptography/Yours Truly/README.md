# Yours Truly

> Write-up author: jon-brandy (SOLVED)

## DESKRIPSI:
I want to send this message to my friend Alice but I'm too busy. Can you send it to her? It has sensitive information though, I've protected it using Alice's RSA public key so don't bother peeking!

[FILE](https://github.com/jon-brandy/COMPFEST14-BAY-WU/blob/09a5d147d15d62178d0b5fa2215222b3a975aa07/Asset/Cryptography/Yours%20Truly/chall.zip)

## HINTS:
1. Given the prime factors, how do you recover the private key in multiprime RSA?
2. You may need to convert the message into its integer form in order to perform the decryption.

## LANGKAH-LANGKAH:
1. Pertama, unduh file `.zip` yang diberikan.
2. Extract zip tersebut.
3. Di dapat 2 file baru bernama `message.enc' dan `pubkey.pem`.

> ISI DARI PUBKEY.PEM

![image](https://user-images.githubusercontent.com/70703371/184534876-8db46448-7b75-4861-af64-5c20e4e1798b.png)

4. Selanjutnya, kita harus mengekstrak modulus dan eksponennya.

> NOTES:

![image](https://user-images.githubusercontent.com/70703371/184535009-a2e2ff89-6207-4ac4-a70a-61fdc527cbc7.png)

> Script yg digunakan:

```py
import os
from Crypto.PublicKey import RSA

os.system('clear')
pubkey = RSA.importKey(open('pubkey.pem', 'r').read())
print(pubkey.n, pubkey.e)
```

> OUTPUT

```
580642391898843192929563856870897799650883152718761762932292482252152591279871421569162037190419036435041797739880389529593674485555792234900969402019055601781662044515999210032698275981631376651117318677368742867687180140048715627160641771118040372573575479330830092989800730105573700557717146251860588802509310534792310748898504394966263819959963273509119791037525504422606634640173277598774814099540555569257179715908642917355365791447508751401889724095964924513196281345665480688029639999472649549163147599540142367575413885729653166517595719991872223011969856259344396899748662101941230745601719730556631637 65537
```

```
N = 580642391898843192929563856870897799650883152718761762932292482252152591279871421569162037190419036435041797739880389529593674485555792234900969402019055601781662044515999210032698275981631376651117318677368742867687180140048715627160641771118040372573575479330830092989800730105573700557717146251860588802509310534792310748898504394966263819959963273509119791037525504422606634640173277598774814099540555569257179715908642917355365791447508751401889724095964924513196281345665480688029639999472649549163147599540142367575413885729653166517595719991872223011969856259344396899748662101941230745601719730556631637 

e = 65537
```

5. Lalu, saya menggunakan [factor.db](http://factordb.com/) untuk mendapatkan 2 deret bilangan prima yang dibutuhkan. Input value dari `N` ke dalam textarea. Lalu click `factorize`.

> HASIL

![image](https://user-images.githubusercontent.com/70703371/184535411-2c985d3f-39da-4b85-8013-0108058a4989.png)

6. Diketahui terdapat lebih dari 2 deret bilangan prima.
7. Berdasarkan hint nomor 1, nampaknya kita tetap dapat mendapatkan nilai `phi` dengan **lebih dari 2 deret bilangan prima**.
8. Maka dari itu saya memasukan hasil pemfaktoran ke dalam sebuah script yang biasanya saya gunakan untuk mendapatkan nilai `phi`.

> SCRIPT

```py
import math
import os

os.system('clear')
result = [9282105380008121879, 9303850685953812323, 9389357739583927789, 10336650220878499841, 
10638241655447339831, 11282698189561966721, 11328768673634243077, 11403460639036243901, 
11473665579512371723, 11492065299277279799, 11530534813954192171, 11665347949879312361, 
12132158321859677597, 12834461276877415051, 12955403765595949597, 12973972336777979701, 
13099895578757581201, 13572286589428162097, 14100640260554622013, 14178869592193599187, 
14278240802299816541, 14523070016044624039, 14963354250199553339, 15364597561881860737, 
15669758663523555763, 15824122791679574573, 15998365463074268941, 16656402470578844539, 
16898740504023346457, 17138336856793050757, 17174065872156629921, 17281246625998849649]

phi = math.prod([i - 1 for i in result])
print(phi)
```

> OUTPUT

```
580642391898843191487404652150193463439642600155214610402815446275117822457602964108279991178253399797937961990567828910318944376020941874995912942457183778540787232677949141800666918857974957805860863128934894322453334083108951829885566055541321469492863749601696156719452204625091396670183612468234453545730714411260422415053794985900973204357184470104831581957188055965458235216412636167147716884241110058234315146752181551500634472836779298794303330378218517375396697137335380548442818167481491481087606998467945980408909917714107491743183639877866494931448463312524563384587536906823474872320000000000000000
```

9. Pada tahap ini kita sudah mempunyai :

```
c = ciphertext
e/E = nilai eksponen
prime factors (> 2)
phi
public key
```

10. Hal terakhir yang kita butuhkan adalah **private key**.

> SCRIPT

```py

import math
from Crypto.PublicKey import RSA
import os
from Crypto.Util.number import bytes_to_long

os.system('clear')

pubkey = RSA.importKey(open('pubkey.pem', 'r').read())

result = [9282105380008121879, 9303850685953812323, 9389357739583927789, 10336650220878499841, 
10638241655447339831, 11282698189561966721, 11328768673634243077, 11403460639036243901, 
11473665579512371723, 11492065299277279799, 11530534813954192171, 11665347949879312361, 
12132158321859677597, 12834461276877415051, 12955403765595949597, 12973972336777979701, 
13099895578757581201, 13572286589428162097, 14100640260554622013, 14178869592193599187, 
14278240802299816541, 14523070016044624039, 14963354250199553339, 15364597561881860737, 
15669758663523555763, 15824122791679574573, 15998365463074268941, 16656402470578844539, 
16898740504023346457, 17138336856793050757, 17174065872156629921, 17281246625998849649]

phi = math.prod([i - 1 for i in result])

cipherText = bytes_to_long(open('message.enc', 'rb').read())
privateKey = pow(pubkey.e, -1, phi)

print(privateKey)

```

> OUTPUT

```
550678668057320270486894977713280661612386679473387004433937990192257019009907567239119014475553352525151197453709254404700764265858700310364694278627740936496980796299768511049032643264376359955800264702060642943865098798169536307529141678474309717202937979408478029523743103567031688359785501822834619529958535700930643075021264741270961281670213783654512824458687819377344959486643077970750359994201843167516881424941358993141613678672658457307473999414959060492054590697942850267611629510044892244182678685166778803001599034675379574122977541489674412812063097749209824025650218295674398899691008132810473473
```

11. Langkah terakhir, saatnya melakukan dekripsi!

> SCRIPT

```
import math
from Crypto.PublicKey import RSA
import os
from Crypto.Util.number import bytes_to_long

os.system('clear')

pubkey = RSA.importKey(open('pubkey.pem', 'r').read())

result = [9282105380008121879, 9303850685953812323, 9389357739583927789, 10336650220878499841, 
10638241655447339831, 11282698189561966721, 11328768673634243077, 11403460639036243901, 
11473665579512371723, 11492065299277279799, 11530534813954192171, 11665347949879312361, 
12132158321859677597, 12834461276877415051, 12955403765595949597, 12973972336777979701, 
13099895578757581201, 13572286589428162097, 14100640260554622013, 14178869592193599187, 
14278240802299816541, 14523070016044624039, 14963354250199553339, 15364597561881860737, 
15669758663523555763, 15824122791679574573, 15998365463074268941, 16656402470578844539, 
16898740504023346457, 17138336856793050757, 17174065872156629921, 17281246625998849649]

phi = math.prod([i - 1 for i in result])

cipherText = bytes_to_long(open('message.enc', 'rb').read())
privateKey = pow(pubkey.e, -1, phi)

final = pow(cipherText, privateKey, pubkey.n)
print(final)
```

> OUTPUT

```
24330718696030382475182157987737780498748696971259627668199357788724616006901159912718869879045300302742582696901978602856558873891257375207992843435178640709161068489793745896443933113267679080783930584931649678340210634877
```

12. Setelah hasil dekripsi di dapat, saatnya convert hasil -> ascii.

> SCRIPT

```
import math
from Crypto.PublicKey import RSA
import os
from Crypto.Util.number import bytes_to_long

os.system('clear')

pubkey = RSA.importKey(open('pubkey.pem', 'r').read())

result = [9282105380008121879, 9303850685953812323, 9389357739583927789, 10336650220878499841, 
10638241655447339831, 11282698189561966721, 11328768673634243077, 11403460639036243901, 
11473665579512371723, 11492065299277279799, 11530534813954192171, 11665347949879312361, 
12132158321859677597, 12834461276877415051, 12955403765595949597, 12973972336777979701, 
13099895578757581201, 13572286589428162097, 14100640260554622013, 14178869592193599187, 
14278240802299816541, 14523070016044624039, 14963354250199553339, 15364597561881860737, 
15669758663523555763, 15824122791679574573, 15998365463074268941, 16656402470578844539, 
16898740504023346457, 17138336856793050757, 17174065872156629921, 17281246625998849649]

phi = math.prod([i - 1 for i in result])

cipherText = bytes_to_long(open('message.enc', 'rb').read())
privateKey = pow(pubkey.e, -1, phi)

final = pow(cipherText, privateKey, pubkey.n)

print(bytearray.fromhex(hex(final)[2:]).decode('ascii'))
```

> OUTPUT

```
COMPFEST14{hello__how_are_you_?_i_hope_youre_doing_alright_thank_you_and_good_bye_2fdf9d6610}
```

## REFERENSI

```
https://www.pengembangan-web-mp-pd.com/id/openssl/rsa-dapatkan-eksponen-dan-modulus-diberi-kunci-publik/969344515/
https://damoneer.github.io/hacker-blog/Primes-Part1
https://ctftime.org/writeup/26719
https://id.wikipedia.org/wiki/RSA
```
